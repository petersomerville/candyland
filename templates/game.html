<!DOCTYPE html>
<html>
<head>
  <title>Candyland Game</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
  <h1>Peter's Candyland</h1>
  
  <div class="board">
    {% for square in game.board.spaces %}
      {% set square_classes = ['square'] %}
      {% if square.is_start %}
        {% set square_classes = square_classes + ['start-square'] %}
      {% endif %}
      {% if square.is_finish %}
        {% set square_classes = square_classes + ['finish-square'] %}
      {% endif %}
      {% if square.is_picture %}
        {% set square_classes = square_classes + ['picture-square', 'picture-' + square.picture_name|lower|replace(' ', '-')] %}
      {% endif %}
      <div class="{{ square_classes|join(' ') }}" style="background-color: {% if square.color %}{{ square.color }}{% else %}#ccc{% endif %};">
        {% if square.is_start %}
          START
        {% elif square.is_finish %}
          END
        {% elif square.is_picture %}
          {{ square.picture_name[0:3] }}
        {% else %}
          {{ square.index }}
        {% endif %}
        {% set pawn_count = 0 %}
        {% for p in game.players %}
          {% if p.position == square.index %}
            {% set pawn_count = pawn_count + 1 %}
            <div class="pawn" title="{{ p.name }}" style="background-color: {% if p.pawn_color %}{{ p.pawn_color }}{% else %}#888{% endif %};">
              {# Optionally add player initial inside pawn #}
            </div>
          {% endif %}
        {% endfor %}
      </div>
    {% endfor %}
  </div>
  
  {% if game.status == "Finished" %}
    <h2>{{ game.winner.name }} Wins!</h2>
    <form action="{{ url_for('reset') }}" method="post">
      <input type="submit" value="Play Again">
    </form>
  {% else %}
    <h3>Current Turn: {{ game.get_current_player().name }}</h3>
    <form action="{{ url_for('draw') }}" method="post">
      <input type="submit" value="Draw Card">
    </form>
  {% endif %}
  
  {# Display the last drawn card visually if it exists #}
  {% if game.last_card %}
    <div class="drawn-card-container">
      <h3>Drawn Card:</h3>
      <div class="drawn-card-visual">
        {% if game.last_card.card_type == 'single' %}
          {# Display one colored square #}
          <div class="card-square" style="background-color: {{ game.last_card.value }};"></div>
          <span class="card-text-label">{{ game.last_card.value|title }}</span> {# Optional text label #}

        {% elif game.last_card.card_type == 'double' %}
          {# Display two colored squares #}
          <div class="card-square" style="background-color: {{ game.last_card.value }};"></div>
          <div class="card-square" style="background-color: {{ game.last_card.value }};"></div>
           <span class="card-text-label">Double {{ game.last_card.value|title }}</span> {# Optional text label #}

        {% elif game.last_card.card_type == 'picture' %}
          {# Display picture name (or image later) #}
          <div class="card-picture">
            {# You could eventually replace this text with an <img> tag #}
            {# <img src="{{ url_for('static', filename='images/' + game.last_card.value|lower|replace(' ', '_') + '.png') }}" alt="{{ game.last_card.value }}"> #}
            <span>{{ game.last_card.value }}</span>
          </div>
        {% endif %}
      </div>
    </div>
  {% endif %}

  
  <h3>Last 6 Moves:</h3>
  <ul>
    {% for msg in game.messages[-6:] %}
      <li>{{ msg }}</li>
    {% endfor %}
  </ul>
  
  <h3>Player Positions:</h3>
  <ul>
    {% for p in game.players %}
      <li>
        <span class="pawn-inline" style="background-color: {{ p.pawn_color | default('#888') }};"></span>
        {{ p.name }}: Position {{ p.position }}
        {% if p.skip_turn %} - Loses Next Turn{% endif %}
      </li>
    {% endfor %}
  </ul>
</body>
</html>
